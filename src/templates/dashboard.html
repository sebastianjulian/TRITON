<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mission Control TRITON</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      /* Dark Ocean (Default) */
      --bg-primary: #0a1520;
      --bg-secondary: #1a2a3a;
      --bg-tertiary: #0f1f2f;
      --bg-card: #1f3545;
      --bg-header: #14242f;
      --color-primary: #00aaff;
      --color-secondary: #0088cc;
      --color-accent: #0066aa;
      --color-text-primary: #ffffff;
      --color-text-secondary: #e0f0ff;
      --color-text-muted: #b0c5dd;
      --color-border: #2a4050;
      --color-border-accent: #00aaff;
      --glow-primary: 0 0 20px rgba(0, 170, 255, 0.3);
      --glow-accent: 0 0 15px rgba(0, 102, 170, 0.2);
      --gradient-bg: linear-gradient(135deg, #0a1520 0%, #1a2a3a 100%);
      --gradient-card: linear-gradient(145deg, #1f3545 0%, #2a4050 100%);
    }
    
    
    [data-theme="night"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-card: #1e293b;
      --bg-header: #0f172a;
      --color-primary: #f59e0b;
      --color-secondary: #d97706;
      --color-accent: #f59e0b;
      --color-text-primary: #f8fafc;
      --color-text-secondary: #e2e8f0;
      --color-text-muted: #94a3b8;
      --color-border: #475569;
      --color-border-accent: #f59e0b;
      --glow-primary: 0 0 20px rgba(245, 158, 11, 0.3);
      --glow-accent: 0 0 15px rgba(217, 119, 6, 0.2);
      --gradient-bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      --gradient-card: linear-gradient(145deg, #1e293b 0%, #334155 100%);
    }
    
    [data-theme="light-ocean"] {
      --bg-primary: #c2e7f7;
      --bg-secondary: #92d4ef;
      --bg-tertiary: #68c1e7;
      --bg-card: #a8dcf4;
      --bg-header: #7ac6eb;
      --color-primary: #0ea5e9;
      --color-secondary: #0284c7;
      --color-accent: #0369a1;
      --color-text-primary: #032436;
      --color-text-secondary: #05314a;
      --color-text-muted: #094358;
      --color-border: #5fb0db;
      --color-border-accent: #0ea5e9;
      --glow-primary: 0 0 20px rgba(14, 165, 233, 0.4);
      --glow-accent: 0 0 16px rgba(3, 105, 161, 0.3);
      --gradient-bg: linear-gradient(135deg, #c2e7f7 0%, #92d4ef 35%, #68c1e7 70%, #4fb6e3 100%);
      --gradient-card: linear-gradient(145deg, #a8dcf4 0%, #7ac6eb 40%, #5fb0db 80%, #4ba3d1 100%);
    }
    
    * {
      transition: color 0.4s ease, background-color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease, background 0.4s ease;
    }

    /* Theme transition animations */
    :root {
      transition: all 0.4s ease;
    }
    
    body, header, section, .chart-box {
      transition: background 0.4s ease, color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--gradient-bg);
      color: var(--color-text-primary);
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      position: relative;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 25% 25%, var(--color-primary)10, transparent 50%),
                  radial-gradient(circle at 75% 75%, var(--color-accent)08, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    header {
      background: var(--bg-header);
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid var(--color-border-accent);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
    }
    
    header::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--color-primary), transparent);
      box-shadow: var(--glow-primary);
    }

    header h1 {
      margin: 0;
      font-size: 1.8em;
      color: var(--color-text-primary);
      text-shadow: var(--glow-primary);
    }

    section {
      padding: 20px 40px;
    }

    h2 {
      color: var(--color-text-primary);
      margin-top: 40px;
      font-size: 1.4em;
      border-left: 4px solid var(--color-primary);
      padding-left: 12px;
      text-shadow: var(--glow-accent);
      position: relative;
    }
    
    h2::before {
      content: '';
      position: absolute;
      left: -4px;
      top: 0;
      width: 4px;
      height: 100%;
      background: var(--color-primary);
      box-shadow: var(--glow-primary);
    }

    .grid-2col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-top: 20px;
    }

    .chart-box {
      background: var(--gradient-card);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      border: 1px solid var(--color-border);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .chart-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at top left, var(--color-primary)05, transparent 50%);
      pointer-events: none;
    }
    
    .chart-box:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.5), var(--glow-primary);
      border-color: var(--color-primary);
    }

    .chart-box h3 {
      margin: 0 0 15px;
      text-align: center;
      font-size: 1.1em;
      color: var(--color-text-primary);
      font-weight: 600;
      text-shadow: var(--glow-accent);
    }

    canvas {
      width: 100% !important;
      aspect-ratio: 1.6;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid var(--color-border);
      padding: 10px 15px;
      text-align: center;
      color: var(--color-text-secondary);
      font-family: 'JetBrains Mono', monospace;
    }

    th {
      background: var(--gradient-card);
      color: var(--color-text-primary);
      font-weight: 600;
      text-shadow: var(--glow-accent);
    }

    .download-controls {
      margin-top: 40px;
    }

    .download-controls button,
    .download-controls select {
      margin: 10px 10px 0 0;
      padding: 8px 12px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
    }

    .download-controls button {
      background: var(--color-primary);
      color: var(--bg-primary);
      cursor: pointer;
      box-shadow: var(--glow-primary);
      border: 1px solid var(--color-primary);
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .download-controls button:hover {
      background: var(--color-accent);
      box-shadow: var(--glow-accent);
      transform: translateY(-1px);
    }

    .download-controls select {
      background: var(--bg-card);
      color: var(--color-text-primary);
      border: 1px solid var(--color-border);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .back-btn {
      background: var(--color-primary);
      color: var(--bg-primary);
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s ease;
      box-shadow: var(--glow-primary);
      border: 1px solid var(--color-primary);
    }

    .back-btn:hover {
      background: var(--color-accent);
      transform: translateY(-2px);
      box-shadow: var(--glow-accent);
    }
    
    /* Theme Selector Styles */
    .theme-selector {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--gradient-card);
      border: 1px solid var(--color-border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: var(--glow-primary), 0 8px 25px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .theme-selector:hover {
      box-shadow: var(--glow-accent), 0 12px 35px rgba(0, 0, 0, 0.5);
    }
    
    .theme-selector h4 {
      margin: 0 0 8px 0;
      color: var(--color-text-primary);
      font-size: 0.8em;
      font-weight: 600;
      text-align: center;
    }
    
    .theme-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 140px;
    }
    
    .theme-options::-webkit-scrollbar {
      width: 3px;
    }
    
    .theme-options::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }
    
    .theme-options::-webkit-scrollbar-thumb {
      background: var(--color-primary);
      border-radius: 2px;
    }
    
    .theme-option {
      padding: 8px 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--color-border);
      border-radius: 6px;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.85em;
      font-weight: 500;
      text-align: center;
    }
    
    .theme-option:hover {
      background: var(--color-primary);
      color: var(--bg-primary);
      transform: translateY(-1px);
      box-shadow: var(--glow-primary);
    }
    
    .theme-option.active {
      background: var(--color-primary);
      color: var(--bg-primary);
      border-color: var(--color-primary);
      box-shadow: var(--glow-primary);
    }
    
    
    @media (max-width: 768px) {
      .theme-selector {
        top: 10px;
        right: 10px;
        padding: 8px;
      }
      
      .theme-options {
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <!-- Theme Selector -->
  <div class="theme-selector">
    <h4>Themes</h4>
    <div class="theme-options">
      <div class="theme-option active" data-theme="dark-ocean">Dark Ocean</div>
      <div class="theme-option" data-theme="night">Night</div>
      <div class="theme-option" data-theme="light-ocean">Light Ocean</div>
    </div>
  </div>
  
  <header>
    <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
      <a href="/" class="back-btn">‚Üê Back to Homepage</a>
      <h1 style="margin: 0;">Mission Control TRITON</h1>
      <div style="width: 140px;"></div> <!-- Spacer for centering -->
    </div>
  </header>

  <!-- Mission Control Section -->
  <section class="download-controls">
    <h2>Mission Control</h2>
    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
      <button id="startStopBtn" onclick="toggleDataGeneration()">Start Test Data</button>
      <select id="speedSelect" onchange="updateSpeed()" style="background-color: #1c1d22; color: #f0f0f0; border: 1px solid #333; padding: 8px 12px; border-radius: 6px;">
        <option value="0.5">0.5x Speed (4s)</option>
        <option value="1">1x Speed (2s)</option>
        <option value="2">2x Speed (1s)</option>
        <option value="5">5x Speed (0.4s)</option>
        <option value="10" selected>10x Speed (0.2s)</option>
      </select>
      <button id="clearBtn" onclick="clearTestData()" style="background-color: #ef4444;">Clear Data</button>
    </div>
    <div style="margin-top: 10px;">
      <span id="generateStatus" style="color: #38bdf8;"></span>
    </div>
  </section>

  <!-- BME280 Section -->
  <section>
    <h2>BME280 Sensor</h2>
    <div class="grid-2col">
      <div class="chart-box"><h3>Temperature [¬∞C]</h3><canvas id="Temp_BME280 [¬∞C]"></canvas></div>
      <div class="chart-box"><h3>Humidity [%]</h3><canvas id="Hum [%]"></canvas></div>
      <div class="chart-box"><h3>Pressure [hPa]</h3><canvas id="Press [hPa]"></canvas></div>
      <div class="chart-box"><h3>Altitude [m]</h3><canvas id="Alt [m]"></canvas></div>
    </div>
  </section>

  <!-- MPU6050 Section -->
  <section>
    <h2>MPU6050 Sensor</h2>
    <div class="grid-2col">
      <div class="chart-box"><h3>Acc X [m/s¬≤]</h3><canvas id="Acc x [m/s¬≤]"></canvas></div>
      <div class="chart-box"><h3>Gyro X [¬∞/s]</h3><canvas id="Gyro x [¬∞/s]"></canvas></div>
      <div class="chart-box"><h3>Acc Y [m/s¬≤]</h3><canvas id="Acc y [m/s¬≤]"></canvas></div>
      <div class="chart-box"><h3>Gyro Y [¬∞/s]</h3><canvas id="Gyro y [¬∞/s]"></canvas></div>
      <div class="chart-box"><h3>Acc Z [m/s¬≤]</h3><canvas id="Acc z [m/s¬≤]"></canvas></div>
      <div class="chart-box"><h3>Gyro Z [¬∞/s]</h3><canvas id="Gyro z [¬∞/s]"></canvas></div>
      <div class="chart-box"><h3>Temperature [¬∞C]</h3><canvas id="Temp_MPU [¬∞C]"></canvas></div>
      <div class="chart-box"><h3></h3></div> <!-- Empty to keep 2-column symmetry -->
    </div>
  </section>

  <!-- Statistics Section -->
  <section>
    <h2>Statistics: BME280</h2>
    <table>
      <thead><tr><th>Metric</th><th>Min</th><th>Max</th><th>Avg</th></tr></thead>
      <tbody id="bmeSummary"></tbody>
    </table>

    <h2 style="margin-top: 50px;">Statistics: MPU6050</h2>
    <table>
      <thead><tr><th>Metric</th><th>Min</th><th>Max</th><th>Avg</th></tr></thead>
      <tbody id="mpuSummary"></tbody>
    </table>
  </section>


  <!-- Download Section -->
  <section class="download-controls">
    <h2>Download Logs</h2>
    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
      <button onclick="downloadLatest()">Download Latest Log</button>
      <select id="logSelect" onchange="downloadSelected()">
        <option value="">-- Select archived log --</option>
      </select>
      <button onclick="openLogsFolder()" style="background-color: #6366f1;">Open Logs Folder</button>
    </div>
    <div style="margin-top: 10px;">
      <span id="folderStatus" style="color: #38bdf8;"></span>
    </div>
  </section>

  <!-- Chart and Data Script -->
  <script>
    const chartRefs = {};
    const fields = {
      "Temp_BME280 [¬∞C]": "bme",
      "Hum [%]": "bme",
      "Press [hPa]": "bme",
      "Alt [m]": "bme",
      "Acc x [m/s¬≤]": "mpu",
      "Acc y [m/s¬≤]": "mpu",
      "Acc z [m/s¬≤]": "mpu",
      "Gyro x [¬∞/s]": "mpu",
      "Gyro y [¬∞/s]": "mpu",
      "Gyro z [¬∞/s]": "mpu",
      "Temp_MPU [¬∞C]": "mpu"
    };

    function createChart(id, label) {
      const ctx = document.getElementById(id).getContext("2d");
      // Get current theme colors
      const computedStyle = getComputedStyle(document.documentElement);
      const primaryColor = computedStyle.getPropertyValue('--color-primary').trim();
      const backgroundColor = primaryColor + '20'; // Add transparency
      
      return new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [{
            label: label,
            data: [],
            borderColor: primaryColor,
            backgroundColor: backgroundColor,
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.3
          }]
        },
        options: {
          animation: false,
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            x: {
              type: "linear",
              title: { display: true, text: "Elapsed [s]", color: computedStyle.getPropertyValue('--color-text-muted').trim() },
              ticks: { color: computedStyle.getPropertyValue('--color-text-secondary').trim() },
              grid: { color: computedStyle.getPropertyValue('--color-border').trim() }
            },
            y: {
              title: { display: true, text: label, color: computedStyle.getPropertyValue('--color-text-muted').trim() },
              ticks: { color: computedStyle.getPropertyValue('--color-text-secondary').trim() },
              grid: { color: computedStyle.getPropertyValue('--color-border').trim() }
            }
          },
          plugins: {
            legend: { labels: { color: computedStyle.getPropertyValue('--color-text-primary').trim() } }
          }
        }
      });
    }

    function computeStats(values) {
      if (!values.length) return ["-", "-", "-"];
      let min = values[0], max = values[0], sum = 0;
      for (let v of values) {
        min = Math.min(min, v);
        max = Math.max(max, v);
        sum += v;
      }
      return [min.toFixed(2), max.toFixed(2), (sum / values.length).toFixed(2)];
    }

    async function fetchData() {
      const res = await fetch("/data");
      const json = await res.json();
      const elapsed = json.history["Elapsed [s]"];
      const bmeRows = [], mpuRows = [];

      for (const [id, group] of Object.entries(fields)) {
        const values = json.history[id] || [];
        if (!chartRefs[id]) {
          chartRefs[id] = createChart(id, id);
        }
        chartRefs[id].data.labels = elapsed;
        chartRefs[id].data.datasets[0].data = values;
        chartRefs[id].update();

        const [min, max, avg] = computeStats(values);
        const row = `<tr><td>${id}</td><td>${min}</td><td>${max}</td><td>${avg}</td></tr>`;
        (group === "bme" ? bmeRows : mpuRows).push(row);
      }

      document.getElementById("bmeSummary").innerHTML = bmeRows.join("");
      document.getElementById("mpuSummary").innerHTML = mpuRows.join("");
    }

    async function loadArchivedLogs() {
      const res = await fetch("/download/list");
      const logs = await res.json();
      const select = document.getElementById("logSelect");
      logs.forEach(filename => {
        const opt = document.createElement("option");
        opt.value = filename;
        opt.textContent = filename;
        select.appendChild(opt);
      });
    }

    function downloadLatest() {
      window.location.href = "/download/latest";
    }

    function downloadSelected() {
      const file = document.getElementById("logSelect").value;
      if (file) window.location.href = `/download/archive/${encodeURIComponent(file)}`;
    }

    async function openLogsFolder() {
      const folderStatus = document.getElementById("folderStatus");
      
      try {
        folderStatus.textContent = "Opening logs folder...";
        folderStatus.style.color = "#fbbf24";
        
        const response = await fetch("/open_logs_folder", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          }
        });
        
        const result = await response.json();
        
        if (result.status === "success") {
          folderStatus.textContent = "Logs folder opened successfully!";
          folderStatus.style.color = "#22c55e";
        } else {
          throw new Error(result.message || "Unknown error");
        }
      } catch (error) {
        folderStatus.textContent = `Error opening folder: ${error.message}`;
        folderStatus.style.color = "#ef4444";
        console.error("Error opening logs folder:", error);
      }
      
      // Clear status message after 3 seconds
      setTimeout(() => {
        folderStatus.textContent = "";
      }, 3000);
    }

    let dataGenerationInterval = null;
    let isGenerating = false;
    let currentSpeed = 10; // Default 10x speed
    const baseInterval = 2000; // Base interval in milliseconds (2 seconds)

    async function generateSingleDataPoint() {
      try {
        const response = await fetch("/generate_random_data", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          }
        });
        
        const result = await response.json();
        if (result.status !== "success") {
          throw new Error(result.message || "Unknown error");
        }
      } catch (error) {
        console.error("Error generating random data:", error);
        // Stop generation on error
        stopDataGeneration();
      }
    }

    function startDataGeneration() {
      if (isGenerating) return;
      
      isGenerating = true;
      const startStopBtn = document.getElementById("startStopBtn");
      const statusSpan = document.getElementById("generateStatus");
      const currentInterval = Math.round(baseInterval / currentSpeed);
      
      startStopBtn.textContent = "‚è∏Ô∏è Stop Test Data";
      startStopBtn.style.backgroundColor = "#ef4444";
      statusSpan.textContent = `üü¢ Generating test data at ${currentSpeed}x speed (${currentInterval}ms intervals)`;
      statusSpan.style.color = "#22c55e";
      
      // Generate data at variable speed based on currentSpeed
      dataGenerationInterval = setInterval(generateSingleDataPoint, currentInterval);
      
      // Generate first data point immediately
      generateSingleDataPoint();
    }

    function stopDataGeneration() {
      if (!isGenerating) return;
      
      isGenerating = false;
      const startStopBtn = document.getElementById("startStopBtn");
      const statusSpan = document.getElementById("generateStatus");
      
      if (dataGenerationInterval) {
        clearInterval(dataGenerationInterval);
        dataGenerationInterval = null;
      }
      
      startStopBtn.textContent = "Start Test Data";
      startStopBtn.style.backgroundColor = "#38bdf8";
      statusSpan.textContent = "‚è∏Ô∏è Test data generation stopped";
      statusSpan.style.color = "#fbbf24";
      
      // Clear status message after 3 seconds
      setTimeout(() => {
        if (!isGenerating) statusSpan.textContent = "";
      }, 3000);
    }

    function toggleDataGeneration() {
      if (isGenerating) {
        stopDataGeneration();
      } else {
        startDataGeneration();
      }
    }

    function updateSpeed() {
      const speedSelect = document.getElementById("speedSelect");
      currentSpeed = parseFloat(speedSelect.value);
      
      // If data generation is running, restart with new speed
      if (isGenerating) {
        stopDataGeneration();
        startDataGeneration();
      }
    }

    async function clearTestData() {
      const clearBtn = document.getElementById("clearBtn");
      const statusSpan = document.getElementById("generateStatus");
      
      // Stop data generation first
      if (isGenerating) {
        stopDataGeneration();
      }
      
      clearBtn.disabled = true;
      clearBtn.textContent = "Clearing...";
      
      try {
        const response = await fetch("/clear_test_data", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          }
        });
        
        const result = await response.json();
        
        if (result.status === "success") {
          statusSpan.textContent = "All test data cleared!";
          statusSpan.style.color = "#22c55e";
          // Clear status message after 3 seconds
          setTimeout(() => {
            statusSpan.textContent = "";
          }, 3000);
        } else {
          throw new Error(result.message || "Unknown error");
        }
      } catch (error) {
        statusSpan.textContent = "Error clearing data";
        statusSpan.style.color = "#ef4444";
        console.error("Error clearing test data:", error);
      } finally {
        clearBtn.disabled = false;
        clearBtn.textContent = "Clear Data";
      }
    }

    // Theme Management System
    class ThemeManager {
      constructor() {
        this.currentTheme = localStorage.getItem('triton-theme') || 'dark-ocean';
        this.init();
      }
      
      init() {
        this.applyTheme(this.currentTheme);
        this.setupEventListeners();
        this.updateActiveButton();
        this.updateChartColors();
      }
      
      applyTheme(themeName) {
        document.documentElement.setAttribute('data-theme', themeName);
        this.currentTheme = themeName;
        localStorage.setItem('triton-theme', themeName);
        // Update chart colors when theme changes
        setTimeout(() => this.updateChartColors(), 100);
      }
      
      updateChartColors() {
        // Get current theme colors
        const computedStyle = getComputedStyle(document.documentElement);
        const primaryColor = computedStyle.getPropertyValue('--color-primary').trim();
        const accentColor = computedStyle.getPropertyValue('--color-accent').trim();
        
        // Update all existing charts
        Object.values(chartRefs).forEach(chart => {
          if (chart && chart.data && chart.data.datasets && chart.data.datasets[0]) {
            chart.data.datasets[0].borderColor = primaryColor;
            chart.data.datasets[0].backgroundColor = primaryColor + '20';
            chart.update('none');
          }
        });
      }
      
      setupEventListeners() {
        const themeOptions = document.querySelectorAll('.theme-option');
        themeOptions.forEach(option => {
          option.addEventListener('click', () => {
            const theme = option.getAttribute('data-theme');
            this.applyTheme(theme);
            this.updateActiveButton();
            
            // Add visual feedback
            option.style.transform = 'scale(0.95)';
            setTimeout(() => {
              option.style.transform = '';
            }, 150);
          });
        });
      }
      
      updateActiveButton() {
        const themeOptions = document.querySelectorAll('.theme-option');
        themeOptions.forEach(option => {
          option.classList.remove('active');
          if (option.getAttribute('data-theme') === this.currentTheme) {
            option.classList.add('active');
          }
        });
      }
    }

    window.onload = () => {
      // Initialize theme management
      new ThemeManager();
      loadArchivedLogs();
      setInterval(fetchData, 1000);
    };
  </script>
</body>
</html>